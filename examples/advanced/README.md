# Advanced example: Creating & using API client libraries with Swagger Codegen

The AIoD API follows the [OpenAPI](https://github.com/OAI/OpenAPI-Specification) specification and therefore a vast amount of tools is available to help developers build apps which utilise its capabilities with minimum effort. On this example you are going to learn how to use the [Swagger Codegen](https://github.com/swagger-api/swagger-codegen) (a project which allows generation of API client libraries given an **OpenAPI Spec**) to post and retrieve data from the AIoD API.

> Before starting, please make sure that the AIoDP API has been successfully installed on your local machine and that you can access it via your web browser at [localhost:8000](http://localhost:8000). For more information read the [Prerequisites](./../../README.md#prerequisites) and the [Getting Started](./../../README.md) guide.

## Installing the required dependencies

### 1. Get the OpenAPI Spec for the AIoD API

Download the OpenAPI Spec for your local instance of the AIoD API via [localhost:8000/openapi.json](http://localhost:8000/openapi.json). You can choose any location that is convenient for you to find and access the file.

### 2. Create the API client libraries with Swagger Codegen

To keep things simple, we are going to use the online tool at [editor.swagger.io](https://editor.swagger.io/) to process the `openapi.json` file, which is required for the creation of the libraries:

1. Visit [editor.swagger.io](https://editor.swagger.io/) using your web browser.
2. Click on **File > Import File**.
3. Select & upload the `openapi.json` file that you've previously downloaded from the AIoD API.
4. Generate the client for PHP using the **Generate Client > php** menu option.
5. Download the `php-client-generated.zip` file and **save it on [the advanced example folder](/.) of this repository** (`/examples/advanced/php-client-generated.zip`).

### 3. Extract the Swagger Codegen client to this repository

1. Using your Terminal, change (`cd`) to [the advanced example folder](/.) (examples/advanced) of this repository.
2. **Unzip** the contents of the downloaded `php-client-generated.zip` archive.
```shell
unzip php-client-generated.zip
```
After the extraction is complete, the [SwaggerClient-php](./SwaggerClient-php) folder under examples/advanced should contain the following sub-directories: `docs`, `lib`, `test`, along with various other files. For this example, only the `lib` folder is required.

#### 4. Install the API clients via Composer

Return to the [root of this project](./../..):

```shell
cd ../..
```

Use **composer** to install the required dependencies:
```shell
composer install
```

Return to the examples/advanced folder:
```shell
cd examples/advanced
```

### Creating a PHP script to post a News item

Again, we are going to create a News item, only this time the API libraries generated by the Swagger Codegen will be used. You can find the complete example on [api-advanced-example.php](./api-advanced-example.php), which can be run directly via the terminal using the `php api-advanced-example.php` command.

#### 1. Loading the dependencies

For this example, the Composer's `autoload.php` file needs to be set as a dependency (it is assumed that you are still working on the examples/advanced folder of this repository). Then, the use statements import the necessary classes from Codegen's auto-generated SDK libraries.
```php
require_once __DIR__ . '/../../vendor/autoload.php';

use Swagger\Client\Model\AIoDNews;
use Swagger\Client\Configuration;
```

#### 2. Configuration

A new instance of the SDK Configuration class is created, which is used to configure the API connection.
```php
$configuration = new Configuration();
$configuration->setHost('localhost:8000');
```

#### 3. Creating a new API client instance

A new instance of the API client (DefaultApi) provided by the SDK libraries is created. The constructor takes two arguments: an instance of GuzzleHttp\Client, which is used for making HTTP requests, and the previously created $configuration object.
```php
$apiInstance = new Swagger\Client\Api\DefaultApi(
    new GuzzleHttp\Client(),
    $configuration,
);
```

#### 4. Populate an object that represents the news item's data

As with the simple example, this time we need to somehow represent the news item's data. Thanks to the libraries, all we have to do is create a new object and set the data!
```php
$body = new AIoDNews();
// Required fields.
$body->setTitle('Hello World Advanced Edition!');
$body->setHeadline('Hello World! The AIoD API salutes you!');
$body->setSection('Hello World News');
$body->setBody('This is the main body of the advanced news item.');
$body->setDateModified((new DateTime())->format(DateTime::ATOM));
$body->setWordCount(str_word_count($body->getBody()));
// Some optional fields.
$body->setSource('AIoD API Examples: PHP');
$body->setBusinessCategories(['Cloud, Edge and Infrastructure']);
$body->setKeywords(['API', 'Education']);
```

#### 5. Submit the data and get the 'Hello World' response

Finally, the API is called to insert the news item and handle the response:
```php
try {
    $result = $apiInstance->newsNewsV0Post($body);
    print_r($result);
    echo $result->getHeadline() . PHP_EOL;
} catch (Exception $e) {
    echo 'Exception when calling DefaultApi->newsNewsV0Post: ', $e->getMessage(), PHP_EOL;
}
```

Even though this approach requires a few additional installation steps the benefits are obvious: increased development efficiency, abstraction of API details, consistency and standardisation, simplified maintenance and reduced chance of errors.

[ [Return to the Index of this repository](./../../README.md) ]